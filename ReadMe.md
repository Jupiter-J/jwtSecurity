# JWT: JSON Web Token

목차
* 세션
  * 세션 Id란?
  * 세션 Id가 사라질 때는?
  * 세션의 단점
* TCP
  * OSI - 7 계층
* JWT


## 세션 Id란
1. 로그인 인증을 위해서 사용
2. 최초의 요청시 세션이라는 저장소에 세션 Id를 만든다.
3. 응답시 헤더에 세션 Id를 돌려준다
4. 클라이언트 웹 브라우저에는 세션Id가 저장된다.
5. 로그인 요청시 사용자가 값을 넣으면 서버가 확인
6. 맞을경우 데이터베이스에 유저정보 저장
7. 메인 페이지로 리턴
8. 2번째턴 -> 유저정보 요청시 세션Id를 가져온다
9. 저장된 세션 저장소에서 같은 값이 있는지 확인
10. DB에서 사용자 정보 응답받음
11. 클라이언트로 반환


### 세션 Id가 사라질 때는?
1. 서버쪽에서 세션Id를 강제로 삭제할 때
2. 사용자가 브라우저를 닫을 경우 (세션값이 날라감)
3. 특정 시간이 지나면 사라진다 (보통 30분)

### 세션의 단점
* 동시 접속자 수가 많아질 경우 세션값을 Db에 넣을경우 부하가 걸려 느려진다
* 메모리 공유 서버(Ram)에 세션을 넣을 경우 속도 개선 ex) Redis

## TCP 
### 통신: OSI-7계층

* 응용계층: 어떤 프로그램을 쓰고 있는지 
* 프레젠테이션: 암호화 & 압축 
* 세션계층: 인증 & 체크
* 트랜스포트: TCP / UDP 선택
  * TCP: 신뢰성이 있다. 내가 보낸 데이터가 잘 도착했는지 항상 확인 (속도 빠름)
  * UDP: 신뢰성이 없다. (속도 느림) 보통 사람이 이해할수 있는 통신의 경우 사용 
* 네트워크: IP로 상대방을 찾는다
* 데이터 링크: IP로 찾은 곳의 LAN: 내부통신으로 들어가 공유기를 찾음
* 물리계층: 전송 

  ![image](https://user-images.githubusercontent.com/73453283/166321226-b582f805-da28-45d5-a2c8-be319fe7695b.png)


## 보안
1. 열쇠 전달 문제 (암호화 한 키를 어떻게 상대방에게 전달할 것인지)
2. 누가 보낸것인지 인증 문제 (도중에 탈취 문제)

## RSA
* public Key : 공개키
* Private Key : 개인키
* 키가 쌍으로 있는 것 : 대칭키

> 공개키 -> 개인키 : 공개키는 개인키로만 열 수 있다. (암호화) 
> 
> 개인키 -> 공개키 : 개인키는 공개키로만 열수 있다. (전자서명/인증)

## RFC
각각의 네트워크 망들이 모여서 만들어진 약속이자 문서 = HTTP 프로토콜

## JWT JSON Web Token
* json 객체로 안전하게 전송하기 위한 방식
* 디지털 서명이 되어있음으로 신뢰할 수 있다
* 서명된 토큰에 중점을 둔다 

### JWT 구조
* Header 헤더 : 어떤 알고리즘을 이용해서 서명을 하였는지에 대한 내용 HS256
* Payload 정보 : 암호화하고 싶은 정보를 담을 수 있다 
* Signature 서명 : 헤더 + 정보 + 개인키를 HS256으로 암호화



---

## 세션의 과정
1. 클라이언트 : 로그인 요청 
2. 서버: 로그인한 유저의 세션 Id 영역을 만들어 세션을 저장 
3. 서버: 저장후 세션 Id 리턴하여 돌려줌
4. 클라이언트 : 웹브라우저 쿠키의 영역에 세션 Id 저장
5. 클라이언트 : 새로운 요청시 쿠키영역의 세션 Id를 가져온다
* 이 방식은 서버가 여러개가 될 경우 서버마다 세션 메모리가 각각 있음으로 확장성과 관리에 좋지 않다
* 클라이언트가 js로 요청시 동일 도메인에서 요청을 할때만 발급이 된다. (동일 출처 정책)  

## HTTP Basic 방식
* 헤더에 Authorization을 넣고 가는 방법 
* 쿠키나 세션을 만들 필요 없이 Authorization에 id, pw를 달고 간다
* 하지만 id, pw가 암호화가 되지 않음 
* 따라서 서버가 Http가 아닌 Https를 사용해야함

## Bearer 방식  
* Authorization에 토큰을 넣는 방식을 사용
* 토큰은 노출이 된다고 해도 직접적인 Id, pw가 아님으로 위험부담이 적다
* 유효시간 등을 설정
* 이 토큰을 JWT로 만들어서 사용한다

---
1. 아이디, 패스워드 로그인 -> 성공
2. 서버쪽 세션Id 생성
3. 클라이언트에게 쿠키 세션 Id를 응답
4. 클라이언트는 요청할때마다 쿠키값 세션 ID를 항상 들고 서버쪽으로 요청
5. 서버는 세션 ID가 유효한지 판단해서 유효하면 인증이 필요한 페이지로 접근하게 해준다 


1. 아이디, 패스워드 로그인 -> 성공
2. JWT토큰을 생성
3. 클라이언트 쪽으로 JWT토큰을 응답
4. 클라이언트는 요청할때마다 JWT토큰을 가지고 요청 
5. 서버는 JWT토큰이 유효한지를 판단 